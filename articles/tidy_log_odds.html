<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tidy Log Odds • tidylo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tidy Log Odds">
<meta property="og:description" content="tidylo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidylo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tidy_log_odds.html">Tidy Log Odds</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/juliasilge/tidylo/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tidy Log Odds</h1>
                        <h4 class="author">Julia Silge and Tyler Schnoebelen</h4>
            
            <h4 class="date">2020-06-15</h4>
      
      <small class="dont-index">Source: <a href="http://github.com/juliasilge/tidylo/blob/master/vignettes/tidy_log_odds.Rmd"><code>vignettes/tidy_log_odds.Rmd</code></a></small>
      <div class="hidden name"><code>tidy_log_odds.Rmd</code></div>

    </div>

    
    
<div id="a-motivating-example-what-words-are-important-to-a-text" class="section level2">
<h2 class="hasAnchor">
<a href="#a-motivating-example-what-words-are-important-to-a-text" class="anchor"></a>A motivating example: what words are important to a text?</h2>
<p>There are multiple ways to measure which words (or bigrams, or other units of text) are important in a text. You can count words, or <a href="https://www.tidytextmining.com/tfidf.html">measure tf-idf</a>. This package implements a different approach for measuring which words are important to a text, a <strong>weighted log odds</strong>.</p>
<p>A log odds ratio is a way of expressing probabilities, and we can weight a log odds ratio so that our implementation does a better job dealing with different combinations of words and documents having different counts. In particular, we use the method outlined in <a href="https://doi.org/10.1093/pan/mpn018">Monroe, Colaresi, and Quinn (2008)</a> for posterior log odds ratios, assuming a multinomial model with a Dirichlet prior. The default prior is <strong>estimated from the data itself</strong>, an empirical Bayesian approach, but an uninformative prior is also available.</p>
<p>What does this mean? It means that by weighting using empirical Bayes estimation, we take into account the sampling error in our measurements and acknowledge that we are more certain when we’ve counted something a lot of times and less certain when we’ve counted something only a few times. When weighting by a prior in this way, we focus on differences that are more likely to be real, given the evidence that we have.</p>
<p>Let’s look at just such an example.</p>
</div>
<div id="jane-austen-and-bigrams" class="section level2">
<h2 class="hasAnchor">
<a href="#jane-austen-and-bigrams" class="anchor"></a>Jane Austen and bigrams</h2>
<p>Let’s explore the <a href="https://github.com/juliasilge/janeaustenr">six published, completed novels of Jane Austen</a> and use the <a href="https://github.com/juliasilge/tidytext">tidytext</a> package to count up the bigrams (sequences of two adjacent words) in each novel, focusing on bigrams that include <em>no upper case letters</em>. (We can look at differences other than those involving proper nouns this way.) This weighted log odds approach would work equally well for single words, or other kinds of n-grams.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/juliasilge/janeaustenr">janeaustenr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://github.com/juliasilge/tidytext">tidytext</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://stringr.tidyverse.org">stringr</a></span>)

<span class="kw">tidy_bigrams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/janeaustenr/man/austen_books.html">austen_books</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span>(<span class="kw">bigram</span>, <span class="kw">text</span>, token=<span class="st">"ngrams"</span>, n = <span class="fl">2</span>, to_lower = <span class="fl">FALSE</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span>(<span class="kw">bigram</span>, <span class="st">"[A-Z]"</span>))

<span class="kw">bigram_counts</span> <span class="op">&lt;-</span> <span class="kw">tidy_bigrams</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span>(<span class="kw">book</span>, <span class="kw">bigram</span>, sort = <span class="fl">TRUE</span>)

<span class="kw">bigram_counts</span>
<span class="co">#&gt; # A tibble: 274,583 x 3</span>
<span class="co">#&gt;    book                bigram     n</span>
<span class="co">#&gt;    &lt;fct&gt;               &lt;chr&gt;  &lt;int&gt;</span>
<span class="co">#&gt;  1 Mansfield Park      of the   744</span>
<span class="co">#&gt;  2 Mansfield Park      to be    613</span>
<span class="co">#&gt;  3 Emma                to be    595</span>
<span class="co">#&gt;  4 Mansfield Park      in the   564</span>
<span class="co">#&gt;  5 Emma                of the   557</span>
<span class="co">#&gt;  6 Pride &amp; Prejudice   of the   462</span>
<span class="co">#&gt;  7 Pride &amp; Prejudice   to be    437</span>
<span class="co">#&gt;  8 Emma                in the   434</span>
<span class="co">#&gt;  9 Sense &amp; Sensibility of the   430</span>
<span class="co">#&gt; 10 Sense &amp; Sensibility to be    428</span>
<span class="co">#&gt; # … with 274,573 more rows</span>
</pre></div>
<p>Notice that we haven’t removed stop words, or filtered out rarely used words. We have done very little pre-processing of this text data.</p>
<p>Now let’s use the <code><a href="../reference/bind_log_odds.html">bind_log_odds()</a></code> function from the tidylo package to find the weighted log odds for each bigram. The weighted log odds computed by this function are also <a href="https://en.wikipedia.org/wiki/Standard_score">z-scores</a> for the log odds; this quantity is useful for comparing frequencies across categories or sets but its relationship to an odds ratio is not straightforward after the weighting.</p>
<p>What are the bigrams with the highest weighted log odds for these books?</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://github.com/juliasilge/tidylo">tidylo</a></span>)

<span class="kw">bigram_log_odds</span> <span class="op">&lt;-</span> <span class="kw">bigram_counts</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/bind_log_odds.html">bind_log_odds</a></span>(<span class="kw">book</span>, <span class="kw">bigram</span>, <span class="kw">n</span>) 

<span class="kw">bigram_log_odds</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="op">-</span><span class="kw">log_odds_weighted</span>)
<span class="co">#&gt; # A tibble: 274,583 x 4</span>
<span class="co">#&gt;    book                bigram            n log_odds_weighted</span>
<span class="co">#&gt;    &lt;fct&gt;               &lt;chr&gt;         &lt;int&gt;             &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Emma                any thing       164             13.9 </span>
<span class="co">#&gt;  2 Northanger Abbey    the pump         24              9.51</span>
<span class="co">#&gt;  3 Sense &amp; Sensibility any thing        61              9.42</span>
<span class="co">#&gt;  4 Northanger Abbey    pump room        23              9.31</span>
<span class="co">#&gt;  5 Northanger Abbey    the abbey        22              9.11</span>
<span class="co">#&gt;  6 Northanger Abbey    the general's    19              8.47</span>
<span class="co">#&gt;  7 Persuasion          any thing         7              7.78</span>
<span class="co">#&gt;  8 Emma                any body         68              7.13</span>
<span class="co">#&gt;  9 Emma                every body       73              6.93</span>
<span class="co">#&gt; 10 Sense &amp; Sensibility the cottage      31              6.81</span>
<span class="co">#&gt; # … with 274,573 more rows</span>
</pre></div>
<p>The highest log odds bigrams (bigrams more likely to come from each book, compared to the others) involve concepts specific to each novel, such as the pump room in <em>Northanger Abbey</em> and sister/mother figures in <em>Sense &amp; Sensibility</em>. We can make a visualization as well.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)

<span class="kw">bigram_log_odds</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">book</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span>(<span class="fl">10</span>) <span class="op">%&gt;%</span>
  <span class="kw">ungroup</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(bigram = <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span>(<span class="kw">bigram</span>, <span class="kw">log_odds_weighted</span>)) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">bigram</span>, <span class="kw">log_odds_weighted</span>, fill = <span class="kw">book</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span>(show.legend = <span class="fl">FALSE</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="kw">book</span>, scales = <span class="st">"free"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(x = <span class="kw">NULL</span>)
</pre></div>
<p><img src="tidy_log_odds_files/figure-html/bigram_plot-1.png" width="960"></p>
<p>These bigrams have the highest weighted log odds for each book.</p>
<p>The proper names of characters tend to be unique from book to book unless you’re looking at a series like <em>Harry Potter</em>. When it comes identifying words or phrases that are unique to a text, a measure like tf-idf does a good job. But because of the way tf-idf is calculated, it cannot distinguish between words that are used in <strong>all</strong> texts.</p>
<p>For example, the phrase “had been” is used over 100 times in all six Austen novels. The “idf” in tf-idf stands for “inverse document frequency”. When a word is in all the texts, tf-idf is zero for all of them. In weighted log odds, however, each book has a different value; in this case the weighted log odds ranges from 5.64 in <em>Persuasion</em> (very high) down to -2.51 in <em>Sense &amp; Sensibility</em> (which suggests something about the style or content is suppressing the phrase).</p>
</div>
<div id="counting-things-other-than-words" class="section level2">
<h2 class="hasAnchor">
<a href="#counting-things-other-than-words" class="anchor"></a>Counting things other than words</h2>
<p>Text analysis is a main motivator for this implementation of weighted log odds, but this is a general approach for measuring how much more likely one feature (any kind of feature, not just a word or bigram) is to be associated than another for some set or group (any kind of set, not just a document or book).</p>
<p>To demonstrate this, let’s look at everybody’s favorite data about cars. What do we know about the relationship between number of gears and engine shape <code>vs</code>?</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">gear_counts</span> <span class="op">&lt;-</span> <span class="kw">mtcars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span>(<span class="kw">vs</span>, <span class="kw">gear</span>)

<span class="kw">gear_counts</span>
<span class="co">#&gt;   vs gear  n</span>
<span class="co">#&gt; 1  0    3 12</span>
<span class="co">#&gt; 2  0    4  2</span>
<span class="co">#&gt; 3  0    5  4</span>
<span class="co">#&gt; 4  1    3  3</span>
<span class="co">#&gt; 5  1    4 10</span>
<span class="co">#&gt; 6  1    5  1</span>
</pre></div>
<p>Now we can use <code><a href="../reference/bind_log_odds.html">bind_log_odds()</a></code> to find the weighted log odds for each number of gears and engine shape. First, let’s use the default empirical Bayes prior. It regularizes the values.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">regularized</span> <span class="op">&lt;-</span> <span class="kw">gear_counts</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/bind_log_odds.html">bind_log_odds</a></span>(<span class="kw">vs</span>, <span class="kw">gear</span>, <span class="kw">n</span>)

<span class="kw">regularized</span>
<span class="co">#&gt;   vs gear  n log_odds_weighted</span>
<span class="co">#&gt; 1  0    3 12         1.1728347</span>
<span class="co">#&gt; 2  0    4  2        -1.3767516</span>
<span class="co">#&gt; 3  0    5  4         0.4033125</span>
<span class="co">#&gt; 4  1    3  3        -1.1354777</span>
<span class="co">#&gt; 5  1    4 10         1.5661168</span>
<span class="co">#&gt; 6  1    5  1        -0.4362340</span>
</pre></div>
<p>For engine shape <code>vs = 0</code>, having three gears has the highest weighted log odds while for engine shape <code>vs = 1</code>, having four gears has the highest weighted log odds. This dataset is small enough that you can look at the count data and see how this is working.</p>
<p>Now, let’s use the uninformative prior, and compare to the unweighted log odds. These log odds will be farther from zero than the regularized estimates.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">unregularized</span> <span class="op">&lt;-</span> <span class="kw">gear_counts</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/bind_log_odds.html">bind_log_odds</a></span>(<span class="kw">vs</span>, <span class="kw">gear</span>, <span class="kw">n</span>, uninformative = <span class="fl">TRUE</span>, unweighted = <span class="fl">TRUE</span>)

<span class="kw">unregularized</span>
<span class="co">#&gt;   vs gear  n   log_odds log_odds_weighted</span>
<span class="co">#&gt; 1  0    3 12  0.6968169         1.8912729</span>
<span class="co">#&gt; 2  0    4  2 -1.2527630        -1.9691060</span>
<span class="co">#&gt; 3  0    5  4  0.3249262         0.5549172</span>
<span class="co">#&gt; 4  1    3  3 -0.9673459        -1.7407107</span>
<span class="co">#&gt; 5  1    4 10  1.1451323         2.8421436</span>
<span class="co">#&gt; 6  1    5  1 -0.5268260        -0.6570674</span>
</pre></div>
<p>Most importantly, you can notice that this approach is useful both in the initial motivating example of text data but also more generally whenever you have counts in some kind of groups or sets and you want to find what feature is more likely to come from a group, compared to the other groups.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tyler Schnoebelen, Julia Silge, Alex Hayes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
