<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weighted Tidy Log Odds Ratio • tidylo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Weighted Tidy Log Odds Ratio">
<meta property="og:description" content="How can we measure how the usage or frequency of some feature, such 
    as words, differs across some group or set, such as documents? One option is 
    to use the log odds ratio, but the log odds ratio alone does not account for 
    sampling variability; we havent counted every feature the same number of 
    times so how do we know which differences are meaningful? Enter the weighted 
    log odds, which tidylo' provides an implementation for, using tidy data 
    principles. In particular, here we use the method outlined in Monroe, 
    Colaresi, and Quinn (2008) &lt;doi:10.1093/pan/mpn018&gt; to weight the log odds 
    ratio by a prior. By default, the prior is estimated from the data itself, 
    an empirical Bayes approach, but an uninformative prior is also available.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tidylo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/tidy_log_odds.html">Tidy Log Odds</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/juliasilge/tidylo/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="tidylo-weighted-tidy-log-odds-ratio" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#tidylo-weighted-tidy-log-odds-ratio" class="anchor"></a>tidylo: Weighted Tidy Log Odds Ratio</h1></div>
<p><strong>Authors:</strong> <a href="https://juliasilge.com/">Julia Silge</a>, <a href="https://www.alexpghayes.com/">Alex Hayes</a>, <a href="https://www.letslanguage.org/">Tyler Schnoebelen</a><br><strong>License:</strong> <a href="https://opensource.org/licenses/MIT">MIT</a></p>
<!-- badges: start -->
<p><a href="https://CRAN.R-project.org/package=tidylo"><img src="https://www.r-pkg.org/badges/version/tidylo" alt="CRAN status"></a> <a href="https://github.com/juliasilge/tidylo/actions"><img src="https://github.com/juliasilge/tidylo/workflows/R-CMD-check/badge.svg" alt="R build status"></a> <a href="https://travis-ci.org/juliasilge/tidylo"><img src="https://travis-ci.org/juliasilge/tidylo.svg?branch=main" alt="Travis build status"></a> <a href="https://ci.appveyor.com/project/juliasilge/tidylo"><img src="https://ci.appveyor.com/api/projects/status/github/juliasilge/tidylo?branch=main&amp;svg=true" alt="AppVeyor build status"></a> <a href="https://codecov.io/gh/juliasilge/tidylo?branch=main"><img src="https://codecov.io/gh/juliasilge/tidylo/branch/main/graph/badge.svg" alt="Codecov test coverage"></a> <a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a> <!-- badges: end --></p>
<p>How can we measure how the usage or frequency of some <strong>feature</strong>, such as words, differs across some group or <strong>set</strong>, such as documents? One option is to use the log odds ratio, but the log odds ratio alone does not account for sampling variability; we haven’t counted every feature the same number of times so how do we know which differences are meaningful?</p>
<p>Enter the <strong>weighted log odds</strong>, which tidylo provides an implementation for, using tidy data principles. In particular, here we use the method outlined in <a href="https://doi.org/10.1093/pan/mpn018">Monroe, Colaresi, and Quinn (2008)</a> to weight the log odds ratio by a prior. By default, the prior is estimated from the data itself, an empirical Bayes approach, but an uninformative prior is also available.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of tidylo from <a href="https://CRAN.R-project.org">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"tidylo"</span>)
</pre></div>
<p>Or you can install the development version from GitHub with <a href="https://github.com/r-lib/remotes">remotes</a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://remotes.r-lib.org">remotes</a></span>)
<span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"juliasilge/tidylo"</span>)
</pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Using weighted log odds is a great approach for text analysis when we want to measure how word usage differs across a set of documents. Let’s explore the <a href="https://github.com/juliasilge/janeaustenr">six published, completed novels of Jane Austen</a> and use the <a href="https://github.com/juliasilge/tidytext">tidytext</a> package to count up the bigrams (sequences of two adjacent words) in each novel. This weighted log odds approach would work equally well for single words.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/juliasilge/janeaustenr">janeaustenr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://github.com/juliasilge/tidytext">tidytext</a></span>)

<span class="kw">tidy_bigrams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/janeaustenr/man/austen_books.html">austen_books</a></span>() <span class="op">%&gt;%</span>
     <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span>(<span class="kw">bigram</span>, <span class="kw">text</span>, token = <span class="st">"ngrams"</span>, n = <span class="fl">2</span>)

<span class="kw">bigram_counts</span> <span class="op">&lt;-</span> <span class="kw">tidy_bigrams</span> <span class="op">%&gt;%</span>
     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span>(<span class="kw">book</span>, <span class="kw">bigram</span>, sort = <span class="fl">TRUE</span>)

<span class="kw">bigram_counts</span>
<span class="co">#&gt; # A tibble: 328,495 x 3</span>
<span class="co">#&gt;    book                bigram     n</span>
<span class="co">#&gt;    &lt;fct&gt;               &lt;chr&gt;  &lt;int&gt;</span>
<span class="co">#&gt;  1 Mansfield Park      of the   748</span>
<span class="co">#&gt;  2 Mansfield Park      to be    643</span>
<span class="co">#&gt;  3 Emma                to be    607</span>
<span class="co">#&gt;  4 Mansfield Park      in the   578</span>
<span class="co">#&gt;  5 Emma                of the   566</span>
<span class="co">#&gt;  6 Pride &amp; Prejudice   of the   464</span>
<span class="co">#&gt;  7 Emma                it was   448</span>
<span class="co">#&gt;  8 Emma                in the   446</span>
<span class="co">#&gt;  9 Pride &amp; Prejudice   to be    443</span>
<span class="co">#&gt; 10 Sense &amp; Sensibility to be    436</span>
<span class="co">#&gt; # … with 328,485 more rows</span>
</pre></div>
<p>Now let’s use the <code><a href="reference/bind_log_odds.html">bind_log_odds()</a></code> function from the tidylo package to find the weighted log odds for each bigram. The weighted log odds computed by this function are also <a href="https://en.wikipedia.org/wiki/Standard_score">z-scores</a> for the log odds; this quantity is useful for comparing frequencies across categories or sets but its relationship to an odds ratio is not straightforward after the weighting.</p>
<p>What are the bigrams with the highest weighted log odds for these books?</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://github.com/juliasilge/tidylo">tidylo</a></span>)

<span class="kw">bigram_log_odds</span> <span class="op">&lt;-</span> <span class="kw">bigram_counts</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="reference/bind_log_odds.html">bind_log_odds</a></span>(<span class="kw">book</span>, <span class="kw">bigram</span>, <span class="kw">n</span>) 

<span class="kw">bigram_log_odds</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="op">-</span><span class="kw">log_odds_weighted</span>)
<span class="co">#&gt; # A tibble: 328,495 x 4</span>
<span class="co">#&gt;    book                bigram                n log_odds_weighted</span>
<span class="co">#&gt;    &lt;fct&gt;               &lt;chr&gt;             &lt;int&gt;             &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Mansfield Park      sir thomas          287              28.3</span>
<span class="co">#&gt;  2 Pride &amp; Prejudice   mr darcy            243              27.7</span>
<span class="co">#&gt;  3 Emma                mr knightley        269              27.5</span>
<span class="co">#&gt;  4 Emma                mrs weston          229              25.4</span>
<span class="co">#&gt;  5 Sense &amp; Sensibility mrs jennings        199              25.2</span>
<span class="co">#&gt;  6 Persuasion          captain wentworth   170              25.1</span>
<span class="co">#&gt;  7 Mansfield Park      miss crawford       215              24.5</span>
<span class="co">#&gt;  8 Persuasion          mr elliot           147              23.3</span>
<span class="co">#&gt;  9 Emma                mr elton            190              23.1</span>
<span class="co">#&gt; 10 Emma                miss woodhouse      162              21.3</span>
<span class="co">#&gt; # … with 328,485 more rows</span>
</pre></div>
<p>The bigrams more likely to come from each book, compared to the others, involve proper nouns. We can make a visualization as well.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)

<span class="kw">bigram_log_odds</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">book</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span>(<span class="fl">10</span>) <span class="op">%&gt;%</span>
  <span class="kw">ungroup</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(bigram = <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span>(<span class="kw">bigram</span>, <span class="kw">log_odds_weighted</span>)) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">bigram</span>, <span class="kw">log_odds_weighted</span>, fill = <span class="kw">book</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span>(show.legend = <span class="fl">FALSE</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="kw">book</span>, scales = <span class="st">"free"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(x = <span class="kw">NULL</span>)
<span class="co">#&gt; Selecting by log_odds_weighted</span>
</pre></div>
<p><img src="reference/figures/README-bigram_plot-1.png" title="plot of chunk bigram_plot" alt="plot of chunk bigram_plot" width="100%"></p>
<div id="community-guidelines" class="section level3">
<h3 class="hasAnchor">
<a href="#community-guidelines" class="anchor"></a>Community Guidelines</h3>
<p>This project is released with a <a href="https://github.com/juliasilge/tidylo/blob/main/CODE_OF_CONDUCT.md">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms. Feedback, bug reports (and fixes!), and feature requests are welcome; file issues or seek support <a href="http://github.com/juliasilge/tidylo/issues">here</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=tidylo">https://​cloud.r-project.org/​package=tidylo</a>
</li>
<li>Browse source code at <br><a href="http://github.com/juliasilge/tidylo/">http://​github.com/​juliasilge/​tidylo/​</a>
</li>
<li>Report a bug at <br><a href="http://github.com/juliasilge/tidylo/issues">http://​github.com/​juliasilge/​tidylo/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Tyler Schnoebelen <br><small class="roles"> Author </small>  </li>
<li>Julia Silge <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-3671-836X" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Alex Hayes <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-4985-5160" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Tyler Schnoebelen, Julia Silge, Alex Hayes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
